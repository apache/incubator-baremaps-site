(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[258],{9543:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/documentation/examples/import-osm-into-postgis",function(){return a(1882)}])},1882:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var o=a(5893),s=a(4319),n=a(1151),i=a(5675),r=a.n(i),l={src:"/_next/static/media/database.ee4f3f49.png",height:342,width:1121,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAACCAIAAADq9gq6AAAAPUlEQVR42gUAOQ6AIIz//8xFnWQyxgiVBEo5yjkRAfoI9IHaAr0/7MwWneT8CPJXq8bjWYtOUfaGnO851AI8YivIE3ozWwAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:2};function d(e){let t=Object.assign({h1:"h1",p:"p",a:"a",h2:"h2",pre:"pre",code:"code",span:"span",h3:"h3"},(0,n.ah)(),e.components);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h1,{children:"Import OSM data into PostGIS"}),"\n",(0,o.jsx)(t.p,{children:"In this tutorial, we'll learn how to use Baremaps to import contour lines data in a PostGIS database."}),"\n",(0,o.jsxs)(t.p,{children:["Notice that the following steps assume that the Apache Baremaps CLI and PostGIS are ",(0,o.jsx)(t.a,{href:"/documentation/getting-started/",children:"installed"}),"."]}),"\n",(0,o.jsx)(t.p,{children:'Also, if you are in a hurry, consider skipping the "Under the Hood" sections.'}),"\n",(0,o.jsx)(t.h2,{id:"dataset",children:"Dataset"}),"\n",(0,o.jsxs)(t.p,{children:["OpenStreetMap (OSM) is a free and editable map of the world.\nIt is maintained by a community of passionate volunteers in a way which is similar to Wikipedia.\nEvery week, OpenStreetMap publishes a ",(0,o.jsx)(t.a,{href:"https://planet.openstreetmap.org/",children:"full dump"})," of its data in two flavours: a large XML file of about 90GB and a more compact binary file of about 50GB in the  ",(0,o.jsx)(t.a,{href:"https://developers.google.com/protocol-buffers",children:"Protocol Buffer Format"})," (PBF).\nAs processing such large files can take several hours, ",(0,o.jsx)(t.a,{href:"http://www.geofabrik.de/data/download.html",children:"Geofabrik"})," regularly publishes smaller extracts of OSM for specific regions.\nIn this example we will use a tiny extract of OSM for ",(0,o.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Liechtenstein",children:"Liechtenstein"}),", which is suitable for fast experiments."]}),"\n",(0,o.jsx)(t.h2,{id:"importing-openstreetmap-data",children:"Importing OpenStreetMap Data"}),"\n",(0,o.jsxs)(t.p,{children:["A workflow is a directed acyclic graph of steps executed by Baremaps.\nTo download and import the sample OSM data in Postgres, execute the following ",(0,o.jsx)(t.a,{href:"https://raw.githubusercontent.com/apache/incubator-baremaps/main/examples/openstreetmap/workflow.json",children:"workflow"}),"."]}),"\n",(0,o.jsx)(t.pre,{"data-language":"text","data-theme":"default",children:(0,o.jsx)(t.code,{"data-language":"text","data-theme":"default",children:(0,o.jsx)(t.span,{className:"line",children:(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"baremaps workflow execute --file examples/openstreetmap/workflow.json"})})})}),"\n",(0,o.jsx)(t.p,{children:"Depending on the size of the OpenStreetMap file, the execution of this command may take some time.\nEventually, the output produced by the command should look as follows."}),"\n",(0,o.jsx)(t.pre,{"data-language":"text","data-theme":"default",children:(0,o.jsxs)(t.code,{"data-language":"text","data-theme":"default",children:[(0,o.jsx)(t.span,{className:"line",children:(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"[INFO ] 2022-07-26 09:47:40.906 [main] Workflow - Executing workflow workflow.json"})}),"\n",(0,o.jsx)(t.span,{className:"line",children:(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"[INFO ] 2022-07-26 09:47:41.208 [pool-2-thread-1] DownloadUrl - Downloading https://download.geofabrik.de/europe/liechtenstein-latest.osm.pbf to liechtenstein-latest.osm.pbf"})}),"\n",(0,o.jsx)(t.span,{className:"line",children:(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"[INFO ] 2022-07-26 09:48:14.496 [pool-2-thread-1] DownloadUrl - Finished downloading https://download.geofabrik.de/europe/liechtenstein-latest.osm.pbf to liechtenstein-latest.osm.pbf"})}),"\n",(0,o.jsx)(t.span,{className:"line",children:(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"[INFO ] 2022-07-26 09:48:14.497 [pool-2-thread-2] ImportOpenStreetMap - Importing liechtenstein-latest.osm.pbf into jdbc:postgresql://localhost:5432/baremaps?&user=baremaps&password=baremaps"})}),"\n",(0,o.jsx)(t.span,{className:"line",children:(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"[INFO ] 2022-07-26 09:48:14.504 [pool-2-thread-2] HikariDataSource - HikariPool-1 - Starting..."})}),"\n",(0,o.jsx)(t.span,{className:"line",children:(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"[INFO ] 2022-07-26 09:48:14.669 [pool-2-thread-2] HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@13d835e3"})}),"\n",(0,o.jsx)(t.span,{className:"line",children:(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"[INFO ] 2022-07-26 09:48:14.671 [pool-2-thread-2] HikariDataSource - HikariPool-1 - Start completed."})}),"\n",(0,o.jsx)(t.span,{className:"line",children:(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"[INFO ] 2022-07-26 09:48:19.172 [pool-2-thread-2] ImportOpenStreetMap - Finished importing liechtenstein-latest.osm.pbf into jdbc:postgresql://localhost:5432/baremaps?&user=baremaps&password=baremaps"})}),"\n",(0,o.jsx)(t.span,{className:"line",children:(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"[INFO ] 2022-07-26 09:48:19.172 [pool-2-thread-2] HikariDataSource - HikariPool-1 - Shutdown initiated..."})}),"\n",(0,o.jsx)(t.span,{className:"line",children:(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"[INFO ] 2022-07-26 09:48:19.177 [pool-2-thread-2] HikariDataSource - HikariPool-1 - Shutdown completed."})}),"\n",(0,o.jsx)(t.span,{className:"line",children:(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"[INFO ] 2022-07-26 09:48:19.178 [pool-2-thread-3] ExecuteSqlFile - Executing indexes.sql into jdbc:postgresql://localhost:5432/baremaps?&user=baremaps&password=baremaps"})}),"\n",(0,o.jsx)(t.span,{className:"line",children:(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"[INFO ] 2022-07-26 09:48:19.179 [pool-2-thread-3] HikariDataSource - HikariPool-2 - Starting..."})}),"\n",(0,o.jsx)(t.span,{className:"line",children:(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"[INFO ] 2022-07-26 09:48:19.213 [pool-2-thread-3] HikariPool - HikariPool-2 - Added connection org.postgresql.jdbc.PgConnection@25c4ab89"})}),"\n",(0,o.jsx)(t.span,{className:"line",children:(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"[INFO ] 2022-07-26 09:48:19.213 [pool-2-thread-3] HikariDataSource - HikariPool-2 - Start completed."})}),"\n",(0,o.jsx)(t.span,{className:"line",children:(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"[INFO ] 2022-07-26 09:48:21.365 [pool-2-thread-3] ExecuteSqlFile - Finished executing indexes.sql into jdbc:postgresql://localhost:5432/baremaps?&user=baremaps&password=baremaps"})}),"\n",(0,o.jsx)(t.span,{className:"line",children:(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"[INFO ] 2022-07-26 09:48:21.365 [pool-2-thread-3] HikariDataSource - HikariPool-2 - Shutdown initiated..."})}),"\n",(0,o.jsx)(t.span,{className:"line",children:(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"[INFO ] 2022-07-26 09:48:21.367 [pool-2-thread-3] HikariDataSource - HikariPool-2 - Shutdown completed."})}),"\n",(0,o.jsx)(t.span,{className:"line",children:(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"[INFO ] 2022-07-26 09:48:21.368 [main] Workflow - Finished executing workflow workflow.json"})})]})}),"\n",(0,o.jsx)(t.h3,{id:"under-the-hood-optional",children:"Under the Hood (Optional)"}),"\n",(0,o.jsx)(t.p,{children:"What can we learn from this output?\nFirst, we notice that Baremaps uses a connection pool to parallelize the import procedure.\nThen it imports the OSM data, populating the tables previously created.\nIn our case, the input is a file provided by Geofabrik."}),"\n",(0,o.jsxs)(t.p,{children:["OSM's ",(0,o.jsx)(t.a,{href:"https://wiki.openstreetmap.org/wiki/Elements",children:"conceptual model"})," builds upon the notions of nodes, ways and relations.\nIn this normalized data model, a line (or way) is formed by a sequence of points (nodes) referenced by their id.\nIn order to save denormalized geometries in PostGIS (e.g. linestring, polygon, multi-polygon, etc.), Baremaps creates a cache for nodes, ways and relations.\n",(0,o.jsx)(t.a,{href:"https://symas.com/lmdb/",children:"LMDB"})," is used under the hood to achieve great performance."]}),"\n",(0,o.jsxs)(t.p,{children:["After the creation of the cache, Baremaps can populate the database with geometries.\nThe geometries are stored in three tables named after the OSM conceptual model: ",(0,o.jsx)(t.code,{children:"osm_nodes"}),", ",(0,o.jsx)(t.code,{children:"osm_ways"}),", and ",(0,o.jsx)(t.code,{children:"osm_relations"}),".\nIn order to improve performances at query time, Baremaps also creates indexes for the tags and the geometries.\nThe following Figure displays the schema of the PostGIS database created by Baremaps."]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(r(),{alt:"PostGIS database",placeholder:"blur",src:l})}),"\n",(0,o.jsx)(t.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,o.jsx)(t.p,{children:"In this tutorial, we learnt how to import OpenStreetMap data in PostGIS."}),"\n",(0,o.jsxs)(t.p,{children:["Now that you have inserted the OSM data into the PostGIS database, you can use follow the ",(0,o.jsx)(t.a,{href:"/documentation/examples/serve-and-export-vector-tiles/",children:"Serve Vector Tiles from PostGIS"})," example to serve\nyour PostGIS data directly as Vector Tiles in a web application with live reload capabilities."]})]})}var c=(0,s.j)({MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:t}=Object.assign({},(0,n.ah)(),e.components);return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)},pageOpts:{filePath:"src/pages/documentation/examples/import-osm-into-postgis.mdx",route:"/documentation/examples/import-osm-into-postgis",frontMatter:{layout:"default",title:"Import OSM data into PostGIS"},headings:[{depth:1,value:"Import OSM data into PostGIS",id:"import-osm-data-into-postgis"},{depth:2,value:"Dataset",id:"dataset"},{depth:2,value:"Importing OpenStreetMap Data",id:"importing-openstreetmap-data"},{depth:3,value:"Under the Hood (Optional)",id:"under-the-hood-optional"},{depth:2,value:"Conclusion",id:"conclusion"}],title:"Import OSM data into PostGIS"},pageNextRoute:"/documentation/examples/import-osm-into-postgis"})}},function(e){e.O(0,[319,774,888,179],function(){return e(e.s=9543)}),_N_E=e.O()}]);