(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[522],{4704:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/documentation/additional-examples/contour-lines-in-vector-tiles",function(){return t(6968)}])},6968:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return h}});var s=t(5893),i=t(4319),o=t(1151),a=t(5675),r=t.n(a),l={src:"/_next/static/media/earthdata-aster-dem.2ba2986d.png",height:1940,width:2964,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAYAAAB4ka1VAAAAsElEQVR4nAGlAFr/AZGQkKgBAgI6+Pj69gYGBQIHCAcAwsPD/u7l1woJCgzGAeHh4csFBgc0/Pv6AAcHBwAFBgUAvbWtAMbDtwAVHCbMAfj4+MMAAAE85eXi+gYGBwILCgoArqqn/mRpdgZ6fXrEAeTk5M4CAgIx9PTzAAgICQD4+/cAnZ2kAImGgwBycnbPAWh2h5AFBgczDgwM9/39/QHd7usA4+Xw/wH8AAkGBQPN/PRF1HoPDRUAAAAASUVORK5CYII=",blurWidth:8,blurHeight:5};function c(e){let n=Object.assign({h1:"h1",p:"p",h2:"h2",code:"code",pre:"pre",span:"span",a:"a",blockquote:"blockquote",strong:"strong",ul:"ul",li:"li"},(0,o.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{children:"Contour Lines in Vector Tiles"}),"\n",(0,s.jsx)(n.p,{children:"Contour lines are a key element in topographic maps, as they allow us to\nvisualize the elevation of an area. In this tutorial, we will show you how\nto create contour lines from a digital elevation model (DEM) and display\nthem using vector tiles."}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(n.p,{children:["To follow this tutorial, you will need to have ",(0,s.jsx)(n.code,{children:"gdal"})," installed on your\nsystem. If you don't have it already, you can install it by running the\nfollowing command:"]}),"\n",(0,s.jsx)(n.pre,{"data-language":"bash","data-theme":"default",children:(0,s.jsx)(n.code,{"data-language":"bash","data-theme":"default",children:(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"sudo "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:"apt-get"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:"install"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:"gdal-bin"})]})})}),"\n",(0,s.jsx)(n.h2,{id:"downloading-the-dem-data",children:"Downloading the DEM Data"}),"\n",(0,s.jsxs)(n.p,{children:["The first step is to download the DEM data. For this tutorial, we will be\nusing the ",(0,s.jsx)(n.a,{href:"https://asterweb.jpl.nasa.gov/gdem.asp",children:"ASTER"})," dataset."]}),"\n",(0,s.jsxs)(n.p,{children:["You can download it from the\n",(0,s.jsx)(n.a,{href:"https://search.earthdata.nasa.gov/search/granules?p=C1711961296-LPCLOUD&pg%5B0%5D%5Bv%5D=f&pg%5B0%5D%5Bgsk%5D=-start_date&q=aster%20v3&tl=1691157297.898!3!!",children:"NASA Earthdata"}),'\nwebsite. You can either select the "granules" or click on the ',(0,s.jsx)(n.code,{children:"Download All"}),"\nbutton to download the entire dataset."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Note: You will need to create a free account on NASA Earthdata to download the data."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(r(),{alt:"Earthdata ASTER DEM",placeholder:"blur",src:l})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Alternative Datasets"})}),"\n",(0,s.jsx)(n.p,{children:"If you want to use a different DEM dataset, below is a list of some other\noptions:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.earthdata.nasa.gov/sensors/srtm",children:"SRTM"})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://registry.opendata.aws/copernicus-dem/",children:"COPERNICUS-DEM"})," (note:\ncontains quite some artifacts)"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"reprojecting-the-geotiff",children:"Reprojecting the GeoTiff"}),"\n",(0,s.jsx)(n.p,{children:"The geotiff file provided in this tutorial is already in the desired\nprojection (WebMercator), but in case you want to use a different geotiff\nfile, you can use the gdalwarp command to reproject it. Here's an example of\nhow to do it:"}),"\n",(0,s.jsx)(n.pre,{"data-language":"text","data-theme":"default",children:(0,s.jsxs)(n.code,{"data-language":"text","data-theme":"default",children:[(0,s.jsx)(n.span,{className:"line",children:(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"gdalwarp -rc \\"})}),"\n",(0,s.jsx)(n.span,{className:"line",children:(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"  -s_srs epsg:4326 -t_srs epsg:3857 \\"})}),"\n",(0,s.jsx)(n.span,{className:"line",children:(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"  -dstnodata 0 -of GTiff -co tiled=yes \\"})}),"\n",(0,s.jsx)(n.span,{className:"line",children:(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"  liecthenstein-aster-dem-v2.tif \\"})}),"\n",(0,s.jsx)(n.span,{className:"line",children:(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"  liecthenstein-aster-dem-v2-3857.tif"})})]})}),"\n",(0,s.jsx)(n.h2,{id:"generating-the-contour-lines",children:"Generating the Contour Lines"}),"\n",(0,s.jsxs)(n.p,{children:["Now that we have the GeoTiff in the desired projection,\nwe can use the gdal_contour command to generate the contour lines.\nThe ",(0,s.jsx)(n.code,{children:"-a"})," argument specifies the column that contains the elevation data,\nthe ",(0,s.jsx)(n.code,{children:"-i"})," argument specifies the interval at which contours\nshould be generated (in this case, we are using 10 meters),\nand the ",(0,s.jsx)(n.code,{children:"-nln"})," argument names the table that will contain the data."]}),"\n",(0,s.jsx)(n.pre,{"data-language":"text","data-theme":"default",children:(0,s.jsxs)(n.code,{"data-language":"text","data-theme":"default",children:[(0,s.jsx)(n.span,{className:"line",children:(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"gdal_contour \\"})}),"\n",(0,s.jsx)(n.span,{className:"line",children:(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"  -a elevation -nln aster_dem -i 10 \\"})}),"\n",(0,s.jsx)(n.span,{className:"line",children:(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"  -f PostgreSQL \\"})}),"\n",(0,s.jsx)(n.span,{className:"line",children:(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:'  liecthenstein-aster-dem-v2-3857.tif "PG:host=localhost user=baremaps password=baremaps dbname=baremaps"'})})]})}),"\n",(0,s.jsx)(n.h2,{id:"improving-performance-with-indexes",children:"Improving Performance with Indexes"}),"\n",(0,s.jsxs)(n.p,{children:["To improve the performance of the contour lines,\nwe can add some indexes to the database.\nHere's an example of how to create a ",(0,s.jsx)(n.code,{children:"SPGIST"})," index:"]}),"\n",(0,s.jsx)(n.pre,{"data-language":"sql","data-theme":"default",children:(0,s.jsxs)(n.code,{"data-language":"sql","data-theme":"default",children:[(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"DROP"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"INDEX"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"IF"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"EXISTS"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" aster_dem_gix;"})]}),"\n",(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"CREATE"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"INDEX"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"IF"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"NOT"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"EXISTS"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" aster_dem_gix "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"ON"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" aster_dem "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"USING"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" SPGIST(wkb_geometry);"})]})]})}),"\n",(0,s.jsx)(n.h2,{id:"displaying-the-contour-lines",children:"Displaying the Contour Lines"}),"\n",(0,s.jsx)(n.p,{children:"Finally, we can use Baremaps to display the contour lines in a web browser.\nTo do this, run the following command:"}),"\n",(0,s.jsx)(n.pre,{"data-language":"bash","data-theme":"default",children:(0,s.jsxs)(n.code,{"data-language":"bash","data-theme":"default",children:[(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"baremaps "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:"map"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:"dev"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" \\"})]}),"\n",(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:"--tileset"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'tileset.json'"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" \\"})]}),"\n",(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:"--style"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'style.json'"})]})]})}),"\n",(0,s.jsx)(n.p,{children:"This will start the tile server and automatically reload the configuration\nfiles when you make changes. You can then preview the map in your\nweb browser."}),"\n",(0,s.jsx)(n.h2,{id:"optional-smoothing-the-contour-lines",children:"Optional: Smoothing the Contour Lines"}),"\n",(0,s.jsx)(n.p,{children:"If you want to improve the rendering of the contour lines, you can use\na smoothing function like ST_ChaikinSmoothing. This function takes\na geometry as input and returns a smoothed version of that geometry.\nHere's an example of how you could use it:"}),"\n",(0,s.jsx)(n.pre,{"data-language":"sql","data-theme":"default",children:(0,s.jsxs)(n.code,{"data-language":"sql","data-theme":"default",children:[(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"UPDATE"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" aster_dem"})]}),"\n",(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"SET"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" wkb_geometry "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" ST_ChaikinSmoothing(wkb_geometry, "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"."}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:")"})]})]})}),"\n",(0,s.jsx)(n.p,{children:"Keep in mind that this step is optional and might not be necessary depending\non the quality of your input data. You can experiment with different\nsmoothing parameters to find the best balance between smoothness and\npreservation of original features."}),"\n",(0,s.jsx)(n.p,{children:"That's it! You now know how to generate and display contour lines from\na digital elevation model using vector tiles. Happy mapping!"})]})}var h=(0,i.j)({MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,o.ah)(),e.components);return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)},pageOpts:{filePath:"src/pages/documentation/additional-examples/contour-lines-in-vector-tiles.mdx",route:"/documentation/additional-examples/contour-lines-in-vector-tiles",frontMatter:{layout:"default",title:"Contour Lines in Vector Tiles"},headings:[{depth:1,value:"Contour Lines in Vector Tiles",id:"contour-lines-in-vector-tiles"},{depth:2,value:"Prerequisites",id:"prerequisites"},{depth:2,value:"Downloading the DEM Data",id:"downloading-the-dem-data"},{depth:2,value:"Reprojecting the GeoTiff",id:"reprojecting-the-geotiff"},{depth:2,value:"Generating the Contour Lines",id:"generating-the-contour-lines"},{depth:2,value:"Improving Performance with Indexes",id:"improving-performance-with-indexes"},{depth:2,value:"Displaying the Contour Lines",id:"displaying-the-contour-lines"},{depth:2,value:"Optional: Smoothing the Contour Lines",id:"optional-smoothing-the-contour-lines"}],title:"Contour Lines in Vector Tiles"},pageNextRoute:"/documentation/additional-examples/contour-lines-in-vector-tiles"})}},function(e){e.O(0,[319,774,888,179],function(){return e(e.s=4704)}),_N_E=e.O()}]);